From 5.x to 6.0
===============

.. contents:: Contents
   :local:
   :depth: 1

Databases
---------

DB Requirements
~~~~~~~~~~~~~~~

 - The minimal MySQL version is now 8.0
 - The minimal MariaDB version is now 10.6

ES Modules
----------

We no longer use RequireJS for inclusion of AMD JavaScript modules. Instead we now rely on the native use of ECMAScript modules.
All modules can be referenced under the same name as an importable module.

Related functions changes
~~~~~~~~~~~~~~~~~~~~~~~~~

* ``elgg_define_js()`` this function has been removed. You might need ``elgg_register_esm()`` as a replacement.
* ``elgg_require_js()`` this function has been removed. You might need ``elgg_import_esm()`` as a replacement.
* ``elgg_unrequire_js()`` this function has been removed

The event 'config', 'amd' has been removed.
The event 'elgg.data', 'site' has been removed. You can switch to the 'elgg.data', 'page' event.

.. note::

	With the switch to ECMAScript modules we can no longer add Sub-Resource Integrity checks to the imported modules.

.. note::

	With the switch to ECMAScript modules we temporarily dropped Javascript testing features. This will be added in the future.

Composer
--------

PHP Requirements
~~~~~~~~~~~~~~~~

The minimal PHP version is now 8.1. Also the ``intl`` module is now required to be enabled.

PHPUnit
~~~~~~~

Elgg now uses PHPUnit 10.5. You might need to update your tests.

Annotations
-----------

Due to a naming conflict in the default join alias between the ``annotations`` and ``metadata`` table, the default join
alias for the ``annotations`` table has been changed from ``n_table`` to ``a_table``.

If your code uses very specific clauses (select, where, order_by, etc.) you need to update your code. If you use the
``\Elgg\Database\QueryBuilder`` for your query parts you should be ok.

Entity Icons
------------

Cropping coordinates
~~~~~~~~~~~~~~~~~~~~

The cropping coordinates of the default icon (``icon``) are now stored in a uniform way, same as those of the other icon types.
The metadata ``x1``, ``x2``, ``y1`` and ``y2`` no longer exist. Use the new ``\ElggEntity`` function ``getIconCoordinates()``.

Changes in functions
--------------------

Removed lib functions
~~~~~~~~~~~~~~~~~~~~~

* ``elgg_unrequire_css()`` has been removed. Use ``elgg_unregister_external_file('css', $view)`` as replacement.

Lib functions function parameters
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* ``elgg_get_simplecache_url()`` has the second argument (``$subview``) removed. The full ``$view`` name needs to be provided as the first argument.

Miscellaneous API changes
-------------------------

* The interface ``\Elgg\EntityIcon`` has been removed. Implemented functions in ``\ElggEntity`` have been moved to ``\Elgg\Traits\Entity\Icons``
* View names from a 'css' or 'js' view folder now always need to be referenced by their full view name (previously is was possible to omit the first folder if it was 'css' or 'js')

Removed Config values
------------------------

* ``system_cache_loaded``
